@model API.DTOs.Accounts.LoginDto
@{
    Layout = "LoginLayout";
}

<div class="login-card">

    <h2>Login</h2>
    <h3>Resource Placement</h3>

    <form action="/resourceplacement/login/" method="post" class="login-form">
        <input type="email" asp-for="Email" placeholder="Email">
        <span asp-validation-for="Email" class="text-danger"></span>
        <input type="password" asp-for="Password" placeholder=" Password">
        <div class="row">
            @*<div class="col-4">
            <button type="submit" class="btn btn-outline-primary">LOGIN</button>
            </div>
            <div class="col-4">
            <a class="btn btn-outline-warning" href="/Register">REGISTER</a>
            </div>
            <div class="col-4">
            <a class="btn btn-outline-danger" href="/Forgot">FORGOT</a>
            </div>*@
            <button type="submit" class="btn btn-primary mb-3">Sign in</button>
        </div>
        <div class="row">
            <div class="col-md-12 d-flex justify-content-center">
                <!-- Simple link -->
                <a class="text-primary" data-bs-toggle="modal" data-bs-target="#modalForgotPassword" style="cursor: pointer; text-decoration: underline;">
                    Forgot password?
                </a>
            </div>
        </div>
        <div class="row">
            <div class="text-center">
                <p>Don't have account? <a class="text-primary" data-bs-toggle="modal" data-bs-target="#modalRegister" style="cursor: pointer; text-decoration: underline;">Register</a> </p>
            </div>
        </div>
    </form>
</div>

<div class="register">
    <div class="modal" id="modalRegister" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Register</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <!-- Name input -->
                        <div class="form-outline mb-4">
                            <label class="form-label" for="registerName">First Name</label>
                            <input type="text" id="firstName" class="form-control" placeholder="First Name" />
                        </div>

                        <!-- Username input -->
                        <div class="form-outline mb-4">
                            <label class="form-label" for="registerUsername">Last Name</label>
                            <input type="text" id="lastName" class="form-control" placeholder="Last Name" />
                        </div>

                        <!-- Email input -->
                        <div class="form-outline mb-4">
                            <label class="form-label" for="registerEmail">Email</label>
                            <input type="email" id="email" class="form-control" placeholder="Email" />
                        </div>

                        <!-- Password input -->
                        <div class="form-outline mb-4">
                            <label class="form-label" for="registerPassword">Password</label>
                            <input type="password" id="password" class="form-control" placeholder="Password" />
                        </div>

                        <!-- Phone Number -->
                        <div class="form-outline mb-4">
                            <label class="form-label" for="registerRepeatPassword">Phone Number</label>
                            <input type="tel" id="phoneNumber" class="form-control" placeholder="Phone Number" />
                        </div>

                        <!-- Gender -->
                        <div class="form-outline mb-4">
                            <label for="gender" class="col-form-label">Gender:</label>
                            <select class="form-control" id="gender" required>
                                <option selected>Select Gender</option>
                                <option value="1">Male</option>
                                <option value="0">Female</option>
                            </select>
                        </div>

                        <!-- Skill -->
                        <div class="form-outline mb-4">
                            <label class="form-label" for="registerRepeatPassword">Skill</label>
                            <input type="text" id="skill" class="form-control" placeholder="Skill" />
                        </div>
                       
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" onclick="register()" class="btn btn-primary d-inline-block" data-bs-dismiss="modal">Register</button>
                    <button type="button" class="btn btn-secondary d-inline-block" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="forgot-password">
    <div class="modal" id="modalForgotPassword" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Forgot Password</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>                      
                        <!-- Email input -->
                        <div class="form-outline mb-4">
                            <label class="form-label" for="forgotEmail">Email</label>
                            <input type="email" id="emailforgot" class="form-control" placeholder="Email">
                        </div>
                        <p>Sudah menerima OTP ? <a asp-controller="ResourcePlacement" asp-action="ChangePassword" class="text-primary" style="cursor: pointer; text-decoration: underline;">Click Here</a> </p>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" onclick="forgotpassword()" class="btn btn-primary d-inline-block" data-bs-dismiss="modal">Send OTP</button>
                    <button type="button" class="btn btn-secondary d-inline-block" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts{
    <script>
        function register() {
            var registerData = {
                firstName: $("#firstName").val(),
                lastName: $("#lastName").val(),
                password: $("#password").val(),
                email: $("#email").val(),
                phoneNumber: $("#phoneNumber").val(),
                gender: parseInt($("#gender").val()),
                skill: $("#skill").val()
            };

            $.ajax({
                url: "https://localhost:7273/api/accounts/Register",
                type: "POST",
                headers: {
                    'Content-Type': 'application/json'
                },
                data: JSON.stringify(accountData),
            }).done(function (result) {
                Swal.fire({
                    title: 'Success',
                    text: 'Data has been registered',
                    icon: 'success'
                }).then(function () {
                    location.reload();
                });
            }).fail(function (error) {
                Swal.fire({
                    title: 'Oops',
                    text: 'Failed to register. Please try again.',
                    icon: 'error'
                });
                console.log(error)
            });
        }

        function forgotpassword() {
            var forgotpassword = {
                email: $("#emailforgot").val()
            };

            $.ajax({
                url: "https://localhost:7273/api/accounts/forgot-password",
                type: "POST",
                headers: {
                    'Content-Type': 'application/json'
                },
                data: JSON.stringify(accountData),
            }).done(function (result) {
                Swal.fire({
                    title: 'Success',
                    text: 'Otp has been sent to your email',
                    icon: 'success'
                }).then(function () {
                    location.reload();
                });
            }).fail(function (error) {
                Swal.fire({
                    title: 'Oops',
                    text: 'Failed to send email. Please try again.',
                    icon: 'error'
                });
                console.log(error)
            });
        }

        function changepassword() {
            var  changepassword = {
                email: $("#emailchange").val(),
                password: $("#passwordchange").val(),,
                newPassword: $("#newPassword").val(),
                otp: $("#otp").val()
            };

            $.ajax({
                url: "https://localhost:7273/api/accounts/changepassword",
                type: "POST",
                headers: {
                    'Content-Type': 'application/json'
                },
                data: JSON.stringify(accountData),
            }).done(function (result) {
                Swal.fire({
                    title: 'Success',
                    text: 'Otp has been sent to your email',
                    icon: 'success'
                }).then(function () {
                    location.reload();
                });
            }).fail(function (error) {
                Swal.fire({
                    title: 'Oops',
                    text: 'Failed to send email. Please try again.',
                    icon: 'error'
                });
                console.log(error)
            });
        }

    </script>
}
